import{S as K,p as N,r as d,s as _,a as y,n as T,i as Q,b as j,t as $,d as x,f as G,e as J,g as L,h as z,k as p,l as V,u as X,c as Y,j as g}from"./index-CuD4dYUJ.js";var Z=class extends K{constructor(e,t){super(),this.options=t,this.#s=e,this.#i=null,this.#r=N(),this.bindMethods(),this.setOptions(t)}#s;#e=void 0;#p=void 0;#t=void 0;#n;#l;#r;#i;#m;#u;#d;#o;#h;#a;#f=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#e.addObserver(this),B(this.#e,this.options)?this.#c():this.updateResult(),this.#R())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return M(this.#e,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return M(this.#e,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#y(),this.#S(),this.#e.removeObserver(this)}setOptions(e){const t=this.options,s=this.#e;if(this.options=this.#s.defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof d(this.options.enabled,this.#e)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#E(),this.#e.setOptions(this.options),t._defaulted&&!_(this.options,t)&&this.#s.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#e,observer:this});const r=this.hasListeners();r&&A(this.#e,s,this.options,t)&&this.#c(),this.updateResult(),r&&(this.#e!==s||d(this.options.enabled,this.#e)!==d(t.enabled,this.#e)||y(this.options.staleTime,this.#e)!==y(t.staleTime,this.#e))&&this.#b();const i=this.#g();r&&(this.#e!==s||d(this.options.enabled,this.#e)!==d(t.enabled,this.#e)||i!==this.#a)&&this.#v(i)}getOptimisticResult(e){const t=this.#s.getQueryCache().build(this.#s,e),s=this.createResult(t,e);return ee(this,s)&&(this.#t=s,this.#l=this.options,this.#n=this.#e.state),s}getCurrentResult(){return this.#t}trackResult(e,t){return new Proxy(e,{get:(s,r)=>(this.trackProp(r),t?.(r),r==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#r.status==="pending"&&this.#r.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(s,r))})}trackProp(e){this.#f.add(e)}getCurrentQuery(){return this.#e}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const t=this.#s.defaultQueryOptions(e),s=this.#s.getQueryCache().build(this.#s,t);return s.fetch().then(()=>this.createResult(s,t))}fetch(e){return this.#c({...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#t))}#c(e){this.#E();let t=this.#e.fetch(this.options,e);return e?.throwOnError||(t=t.catch(T)),t}#b(){this.#y();const e=y(this.options.staleTime,this.#e);if(Q||this.#t.isStale||!j(e))return;const s=$(this.#t.dataUpdatedAt,e)+1;this.#o=x.setTimeout(()=>{this.#t.isStale||this.updateResult()},s)}#g(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#e):this.options.refetchInterval)??!1}#v(e){this.#S(),this.#a=e,!(Q||d(this.options.enabled,this.#e)===!1||!j(this.#a)||this.#a===0)&&(this.#h=x.setInterval(()=>{(this.options.refetchIntervalInBackground||G.isFocused())&&this.#c()},this.#a))}#R(){this.#b(),this.#v(this.#g())}#y(){this.#o&&(x.clearTimeout(this.#o),this.#o=void 0)}#S(){this.#h&&(x.clearInterval(this.#h),this.#h=void 0)}createResult(e,t){const s=this.#e,r=this.options,i=this.#t,h=this.#n,a=this.#l,v=e!==s?e.state:this.#p,{state:c}=e;let n={...c},R=!1,o;if(t._optimisticResults){const u=this.hasListeners(),E=!u&&B(e,t),b=u&&A(e,s,t,r);(E||b)&&(n={...n,...J(c.data,e.options)}),t._optimisticResults==="isRestoring"&&(n.fetchStatus="idle")}let{error:S,errorUpdatedAt:U,status:m}=n;o=n.data;let k=!1;if(t.placeholderData!==void 0&&o===void 0&&m==="pending"){let u;i?.isPlaceholderData&&t.placeholderData===a?.placeholderData?(u=i.data,k=!0):u=typeof t.placeholderData=="function"?t.placeholderData(this.#d?.state.data,this.#d):t.placeholderData,u!==void 0&&(m="success",o=L(i?.data,u,t),R=!0)}if(t.select&&o!==void 0&&!k)if(i&&o===h?.data&&t.select===this.#m)o=this.#u;else try{this.#m=t.select,o=t.select(o),o=L(i?.data,o,t),this.#u=o,this.#i=null}catch(u){this.#i=u}this.#i&&(S=this.#i,o=this.#u,U=Date.now(),m="error");const C=n.fetchStatus==="fetching",w=m==="pending",I=m==="error",F=w&&C,D=o!==void 0,f={status:m,fetchStatus:n.fetchStatus,isPending:w,isSuccess:m==="success",isError:I,isInitialLoading:F,isLoading:F,data:o,dataUpdatedAt:n.dataUpdatedAt,error:S,errorUpdatedAt:U,failureCount:n.fetchFailureCount,failureReason:n.fetchFailureReason,errorUpdateCount:n.errorUpdateCount,isFetched:n.dataUpdateCount>0||n.errorUpdateCount>0,isFetchedAfterMount:n.dataUpdateCount>v.dataUpdateCount||n.errorUpdateCount>v.errorUpdateCount,isFetching:C,isRefetching:C&&!w,isLoadingError:I&&!D,isPaused:n.fetchStatus==="paused",isPlaceholderData:R,isRefetchError:I&&D,isStale:P(e,t),refetch:this.refetch,promise:this.#r,isEnabled:d(t.enabled,e)!==!1};if(this.options.experimental_prefetchInRender){const u=O=>{f.status==="error"?O.reject(f.error):f.data!==void 0&&O.resolve(f.data)},E=()=>{const O=this.#r=f.promise=N();u(O)},b=this.#r;switch(b.status){case"pending":e.queryHash===s.queryHash&&u(b);break;case"fulfilled":(f.status==="error"||f.data!==b.value)&&E();break;case"rejected":(f.status!=="error"||f.error!==b.reason)&&E();break}}return f}updateResult(){const e=this.#t,t=this.createResult(this.#e,this.options);if(this.#n=this.#e.state,this.#l=this.options,this.#n.data!==void 0&&(this.#d=this.#e),_(t,e))return;this.#t=t;const s=()=>{if(!e)return!0;const{notifyOnChangeProps:r}=this.options,i=typeof r=="function"?r():r;if(i==="all"||!i&&!this.#f.size)return!0;const h=new Set(i??this.#f);return this.options.throwOnError&&h.add("error"),Object.keys(this.#t).some(a=>{const l=a;return this.#t[l]!==e[l]&&h.has(l)})};this.#O({listeners:s()})}#E(){const e=this.#s.getQueryCache().build(this.#s,this.options);if(e===this.#e)return;const t=this.#e;this.#e=e,this.#p=e.state,this.hasListeners()&&(t?.removeObserver(this),e.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#R()}#O(e){z.batch(()=>{e.listeners&&this.listeners.forEach(t=>{t(this.#t)}),this.#s.getQueryCache().notify({query:this.#e,type:"observerResultsUpdated"})})}};function q(e,t){return d(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function B(e,t){return q(e,t)||e.state.data!==void 0&&M(e,t,t.refetchOnMount)}function M(e,t,s){if(d(t.enabled,e)!==!1&&y(t.staleTime,e)!=="static"){const r=typeof s=="function"?s(e):s;return r==="always"||r!==!1&&P(e,t)}return!1}function A(e,t,s,r){return(e!==t||d(r.enabled,e)===!1)&&(!s.suspense||e.state.status!=="error")&&P(e,s)}function P(e,t){return d(t.enabled,e)!==!1&&e.isStaleByTime(y(t.staleTime,e))}function ee(e,t){return!_(e.getCurrentResult(),t)}var W=p.createContext(!1),te=()=>p.useContext(W);W.Provider;function se(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var re=p.createContext(se()),ie=()=>p.useContext(re),ae=(e,t,s)=>{const r=s?.state.error&&typeof e.throwOnError=="function"?V(e.throwOnError,[s.state.error,s]):e.throwOnError;(e.suspense||e.experimental_prefetchInRender||r)&&(t.isReset()||(e.retryOnMount=!1))},ne=e=>{p.useEffect(()=>{e.clearReset()},[e])},oe=({result:e,errorResetBoundary:t,throwOnError:s,query:r,suspense:i})=>e.isError&&!t.isReset()&&!e.isFetching&&r&&(i&&e.data===void 0||V(s,[e.error,r])),he=e=>{if(e.suspense){const s=i=>i==="static"?i:Math.max(i??1e3,1e3),r=e.staleTime;e.staleTime=typeof r=="function"?(...i)=>s(r(...i)):s(r),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},ce=(e,t)=>e.isLoading&&e.isFetching&&!t,le=(e,t)=>e?.suspense&&t.isPending,H=(e,t,s)=>t.fetchOptimistic(e).catch(()=>{s.clearReset()});function ue(e,t,s){const r=te(),i=ie(),h=X(),a=h.defaultQueryOptions(e);h.getDefaultOptions().queries?._experimental_beforeQuery?.(a);const l=h.getQueryCache().get(a.queryHash);a._optimisticResults=r?"isRestoring":"optimistic",he(a),ae(a,i,l),ne(i);const v=!h.getQueryCache().get(a.queryHash),[c]=p.useState(()=>new t(h,a)),n=c.getOptimisticResult(a),R=!r&&e.subscribed!==!1;if(p.useSyncExternalStore(p.useCallback(o=>{const S=R?c.subscribe(z.batchCalls(o)):T;return c.updateResult(),S},[c,R]),()=>c.getCurrentResult(),()=>c.getCurrentResult()),p.useEffect(()=>{c.setOptions(a)},[a,c]),le(a,n))throw H(a,c,i);if(oe({result:n,errorResetBoundary:i,throwOnError:a.throwOnError,query:l,suspense:a.suspense}))throw n.error;return h.getDefaultOptions().queries?._experimental_afterQuery?.(a,n),a.experimental_prefetchInRender&&!Q&&ce(n,r)&&(v?H(a,c,i):l?.promise)?.catch(T).finally(()=>{c.updateResult()}),a.notifyOnChangeProps?n:c.trackResult(n)}function de(e,t){return ue(e,Z)}function ge(){const e=Y.c(8);let t;e[0]===Symbol.for("react.memo_cache_sentinel")?(t=["todos"],e[0]=t):t=e[0];let s;e[1]===Symbol.for("react.memo_cache_sentinel")?(s={queryKey:t,queryFn:pe,initialData:[]},e[1]=s):s=e[1];const{data:r}=de(s);let i;e[2]===Symbol.for("react.memo_cache_sentinel")?(i={backgroundImage:"radial-gradient(50% 50% at 95% 5%, #f4a460 0%, #8b4513 70%, #1a0f0a 100%)"},e[2]=i):i=e[2];let h;e[3]===Symbol.for("react.memo_cache_sentinel")?(h=g.jsx("h1",{className:"text-2xl mb-4",children:"TanStack Query Simple Promise Handling"}),e[3]=h):h=e[3];let a;e[4]!==r?(a=r.map(fe),e[4]=r,e[5]=a):a=e[5];let l;return e[6]!==a?(l=g.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-purple-100 to-blue-100 p-4 text-white",style:i,children:g.jsxs("div",{className:"w-full max-w-2xl p-8 rounded-xl backdrop-blur-md bg-black/50 shadow-xl border-8 border-black/10",children:[h,g.jsx("ul",{className:"mb-4 space-y-2",children:a})]})}),e[6]=a,e[7]=l):l=e[7],l}function fe(e){return g.jsx("li",{className:"bg-white/10 border border-white/20 rounded-lg p-3 backdrop-blur-sm shadow-md",children:g.jsx("span",{className:"text-lg text-white",children:e.name})},e.id)}function pe(){return Promise.resolve([{id:1,name:"Alice"},{id:2,name:"Bob"},{id:3,name:"Charlie"}])}export{ge as component};
